FROM node:20-alpine

RUN apk add --no-cache ffmpeg ffmpeg-dev

WORKDIR /app

COPY package*.json ./
RUN npm ci --only=production && npm install typescript

COPY . .

# Install ts-node for development/testing
RUN npm install -g ts-node

EXPOSE 5000

# Use ts-node with transpile-only to skip type checking
CMD ["ts-node", "--transpile-only", "server.ts"]
